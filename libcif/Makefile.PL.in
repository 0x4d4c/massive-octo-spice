use 5.014002;
use ExtUtils::MakeMaker;
use ExtUtils::MakeMaker::CPANfile;

sub MY::libscan {
    my( $mm, $file ) = @_;
    return if $file =~  /\.(swp|in)$/; # SKIP
    return $file;
}

sub MY::postamble {
    return <<'MAKE_FRAG';

deps:
	cpanm --installdeps .

fixperms:
	chmod 0770 $(DESTDIR)$(localstatedir)
	chown -R $(CIF_USER) $(DESTDIR)$(localstatedir)
	chgrp -R $(CIF_GROUP) $(DESTDIR)$(localstatedir)

install-var:
	[ -d $(DESTDIR)$(localstatedir) ] || $(INSTALL) -m 770 -d $(DESTDIR)$(localstatedir)

install-geoip: install-var
	$(INSTALL) -m 660 "contrib/GeoLite2-City.mmdb" "$(DESTDIR)$(localstatedir)/GeoLite2-City.mmdb"

MAKE_FRAG
}

WriteMakefile(
    NAME            => 'CIF',
    VERSION         => '@CIF_VERSION@',
	EXE_FILES	    => ['bin/cif'],
    NO_META         => 1,
    NO_MYMETA       => 1,
);
